FROM golang:1.23-alpine AS builder

ENV GOTOOLCHAIN=auto

WORKDIR /app

# Copy module files for the reservations service first to leverage Docker cache
COPY backend/reservations-api/go.mod backend/reservations-api/go.sum ./backend/reservations-api/

# Copy the whole repository into the image under /app
COPY . /app

# Switch to the service directory, download deps and build
WORKDIR /app/backend/reservations-api
RUN go mod download
RUN go build -o /app/reservations-service .

EXPOSE 8080

CMD ["/app/reservations-service"]
